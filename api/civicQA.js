const { GoogleGenerativeAI } = require('@google/generative-ai');\nconst IndianCivicDataFetcher = require('../functions/ragFetcher');\nconst { CIVIC_PROMPTS, formatPrompt } = require('../functions/promptTemplates');\n\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);\nconst dataFetcher = new IndianCivicDataFetcher();\n\nmodule.exports = async (req, res) => {\n  // Enable CORS\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.setHeader('Access-Control-Allow-Methods', 'POST, OPTIONS');\n  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');\n  \n  if (req.method === 'OPTIONS') {\n    return res.status(200).end();\n  }\n  \n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const { question, language = 'english' } = req.body;\n    \n    if (!question || question.trim().length === 0) {\n      return res.status(400).json({ error: 'Question is required' });\n    }\n\n    const queryType = dataFetcher.detectQueryType(question);\n    const civicData = await dataFetcher.fetchRelevantData(question, queryType);\n    const cleanedData = dataFetcher.cleanData(civicData.data);\n    \n    const prompt = formatPrompt(CIVIC_PROMPTS.QA_PROMPT, {\n      context: cleanedData,\n      question: question.trim(),\n      language: language\n    });\n\n    const model = genAI.getGenerativeModel({ model: \"gemini-pro\" });\n    const result = await model.generateContent(prompt);\n    const response = result.response.text();\n    \n    res.json({\n      response,\n      sources: civicData.sources,\n      urls: civicData.urls,\n      queryType: queryType,\n      disclaimer: \"This is an AI-generated civic explanation based on public information. Not political advice.\"\n    });\n    \n  } catch (error) {\n    console.error('Error in civicQA:', error);\n    res.status(500).json({ \n      error: 'Unable to process your question at the moment. Please try again.'\n    });\n  }\n};